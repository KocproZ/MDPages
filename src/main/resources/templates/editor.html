<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      layout:decorator="fragments/layout">

<div layout:fragment="content">
    <div class="container">
        <div class="row">
            <div class="col s6">
                <form method="post" th:action="${name != null} ? '/update' : '/add'">
                    <div class="row input-field">
                        <div class="col m9">
                            <input name="name" th:readonly="${name != null}" th:value="${name != null} ? ${name} : ''"/>
                        </div>
                        <div class="col m3">
                            <input class="waves-effect waves-light btn" value="save" type="submit"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col m12" id="editor" th:text="${content != null} ? ${content} : ''"></div>
                    </div>
                    <input type="hidden" id="contentValue" name="mdPage"/>
                </form>
            </div>
            <div class="col s6" id="preview"></div>
        </div>
    </div>

    <style>
        #editor {
            position: relative;
            height: 80vh;
        }
    </style>

    <script src="/js/showdown.min.js"></script>
    <script src="/js/highlight.min.js"></script>
    <script src="/js/ace/ace.js"></script>
    <script th:inline="javascript">
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/twilight");
    editor.session.setMode("ace/mode/markdown");
    editor.on('change', update);

    function update(e) {
        var converter = new showdown.Converter();
        converter.setOption('tasklists', true);
        converter.setOption('ghCodeBlocks', true);
        var text      = editor.getValue();
        var html      = converter.makeHtml(text);
        document.getElementById("preview").innerHTML = html;
        document.getElementById("contentValue").value = text;
        $('pre code').each(function(i, block) {
            hljs.highlightBlock(block);
        });
    }
    setTimeout(update, 500);
    </script>

</div>
</html>
